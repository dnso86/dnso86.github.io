<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta name="author" content="">
        <title>Isdal Woman Destroyed name-finder</title>
        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous"> </head>

    <body>
        <main role="main" class="container">
            <form>
                <div class="container">
                    <div class="row">
                        <div class="col-sm"> <small>First name</small>
                            <div class="form-group"> <label for="first_name_characters">Number of characters</label> <input type="number" name="first_name_characters" id="first_name_characters" min="1" max="16" value=7> </div>
                        </div>
                        <div class="col-sm"> <input type="checkbox" class="form-check-input" id="enable_last_name"> <small>Last name</small>
                            <div class="form-group"> <label for="last_name_characters">Number of characters</label> <input type="number" name="last_name_characters" id="last_name_characters" min="1" max="16" value=5 disabled> </div>
                        </div>
                        <div class="col-sm"> <input type="checkbox" class="form-check-input" id="fvarious" checked> <small><label for="fvarious">Various female first names</label></small><br> <input type="checkbox" class="form-check-input" id="ffirst" checked> <small><label for="ffirst">French female first names 1926-30</label></small><br> <input type="checkbox" class="form-check-input" id="gfirst" checked> <small><label for="gfirst">German female first names 1926-34</label></small><br> <input type="checkbox" class="form-check-input" id="gvarious" checked> <small><label for="gvarious">German various names ~1930</label></small><br> <input type="checkbox" class="form-check-input" id="ffamily" checked> <small><label for="ffamily">Various french family names</label></small><br> <input type="checkbox" class="form-check-input" id="belgien" checked> <small><label for="belgien">Belgian locations + Flemish/Dutch names</label></small><br> <br/> <input type="checkbox" class="form-check-input" id="fixed" checked> <small><label for="fixed">Fixed length names</label></small><br> <small>Additional names, separated by comma</small> <input type="text" name="fname" id="extra_names"> </div>
                    </div>
                </div>
            </form>
            <div class="container">
                <div class="row">
                    <div class="col-sm" id="first_name_div"> </div>
                    <div class="col-sm" id="last_name_div"> </div>
                    <p>Presets</p>
                    <div class="col-sm"> <br> <button type="button" id="myidea1">My idea 1</button> <br> <button type="button" id="aske">D. Aske</button><br> <button type="button" id="minimal">Minimal</button></div>
                    <div class="col-sm"> <br> <button type="button" id="tielt">ðŸ›‚ Tielt</button> <br> <button type="button" id="jarle">ðŸ›‚ Jarle</button> <br> <button type="button" id="fenella">ðŸ›‚ Fenella</button> <br> <button type="button" id="schloss">ðŸ›‚ Schlosseneck</button> </div>
                </div>
            </div>
            <div class="container">
                <div class="row"> <textarea rows="10" cols="120" id="results"></textarea> </div>
            </div>
            <p>Based on the idea described in <strong>Dennis Zacher Aske - Kvinnen i Isdalen</strong>, ISBN 9788241916601 !</p>
        </main>
        <!-- /.container -->
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script src="names.js"></script>
        <script language='javascript' type='text/javascript'>
            var allNames = '';

            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            function normalizeArray(list) {
                for (var i = 0; i < list.length; i++) list[i] = list[i].trim();
                return list.join(' ');
            }
            
            function addNames(sset, list) {
				list.forEach(function (item){
					sset.add(capitalizeFirstLetter(item));
				});
			}

            function initNames() {
                var allRawNames = new Set();
                if ($('#fvarious').is(':checked')) addNames(allRawNames, variousNames);
                if ($('#ffirst').is(':checked')) addNames(allRawNames, frenchWomanNames);
                if ($('#gfirst').is(':checked')) addNames(allRawNames, germanWomanNames);
                if ($('#gvarious').is(':checked')) addNames(allRawNames, germanVariousNames);
                if ($('#ffamily').is(':checked')) addNames(allRawNames, frenchFamilyNames);
                if ($('#belgien').is(':checked')) addNames(allRawNames, belgiumTowns);
                if ($('#extra_names').val()) {
                    var extranames = $('#extra_names').val().split(',');
                    addNames(allRawNames, extranames);
                }
                allNames = normalizeArray(Array.from(allRawNames));
                console.log(String(allNames.length) + ' names.');
            }

            function addNamebox(div, name, i) {
                var nameboxName = name + String(i);
                div.append('<pre class="' + nameboxName + '">' + String(i) + ' <input size = "15" type="text" class="' + nameboxName + '"></pre>');
                return $('#' + nameboxName);
            }

            function createRegex(name) {
                var wildcard;
                if ($('#fixed').is(':checked')) {
                    wildcard = '\\S';
                } else {
                    wildcard = '\\S?';
                }
                alphanumeric = new RegExp('[a-z|A-Z]');
                var allWildcard = true;
                var regexx = '';
                for (var i = 1; i <= $('#' + name + '_characters').val(); i++) {
                    var textValue = $('input.' + name + String(i)).val();
                    if (alphanumeric.test(textValue)) {
                        regexx += '[' + textValue + ']';
                        allWildcard = false;
                    } else regexx += wildcard;
                }
                if (!allWildcard) {
                    console.log('Regex: ' + regexx);
                    return new RegExp('\\b' + regexx + '\\b', 'gi');
                } else {
                    return null;
                }
            }

            function getHits(names, regex) {
                var results = [];
                if (regex == null) return results;
                do {
                    m = regex.exec(names);
                    if (m) {
                        results.push(m);
                    }
                } while (m);
                return [...new Set(results)];
            }

            function resetNameBoxes() {
                var names = ['first_name'];
                if ($('#enable_last_name').is(':checked')) {
                    names.push('last_name');
                }
                names.forEach(function (name) {
                    var i = 1;
                    for (; i <= 16; i++) {
                        var divName = '#' + name + '_div';
                        if ($('.' + name + String(i)).length) {
                            $('.' + name + String(i)).val('');
                        }
                    }
                });
            }

            function placeNameBoxes() {
                var names = ['first_name'];
                if ($('#enable_last_name').is(':checked')) {
                    names.push('last_name');
                }
                names.forEach(function (name) {
                    var i = 1;
                    for (; i <= $('#' + name + '_characters').val(); i++) {
                        var divName = '#' + name + '_div';
                        if ($('.' + name + String(i)).length) {
                            $('.' + name + String(i)).show();
                        } else {
                            addNamebox($(divName), name, i);
                        }
                    }
                    while ($('.' + name + String(i)).length) {
                        $('.' + name + String(i++)).hide();
                    }
                });
            }
            var uniqueArray = function (arrArg) {
                // https://gist.github.com/telekosmos/3b62a31a5c43f40849bb
                return arrArg.filter(function (elem, pos, arr) {
                    return arr.indexOf(elem) == pos;
                });
            };

            function findNames() {
                var combinations = [];
                var firstNameHits = getHits(allNames, createRegex('first_name'));
                var lastNameHits = [];
                if ($('#enable_last_name').is(':checked')) {
                    lastNameHits = getHits(allNames, createRegex('last_name'));
                    firstNameHits.forEach(function (a1) {
                        lastNameHits.forEach(function (a2) {
                            combinations.push(a1 + ' ' + a2);
                        });
                    });
                } else {
                    combinations = firstNameHits;
                }
                combinations.sort();
                $('#results').val(uniqueArray(combinations).join('\n'));
            }
            
            function doSearch() {
				placeNameBoxes();
				findNames();				
			}
            $(document).ready(function () {
                initNames();
                $('#myidea1').click(function () {
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", true);
                    $("#fixed").prop("checked", true);
                    $('#last_name_characters').prop('disabled', false);
                    $("#first_name_characters").val(7);
                    $("#last_name_characters").val(5);
                    placeNameBoxes();
                    $("input.first_name1").val("OCGUVQ");
                    $("input.first_name2").val("Ilidf");
                    $("input.first_name3").val("seaonc");
                    $("input.first_name4").val("eaugr");
                    $("input.first_name5").val("lditIf");
                    $("input.first_name7").val("aoe");
                    $("input.last_name2").val("i");
                    findNames();
                });
                $('#aske').click(function () {
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", true);
                    $("#fixed").prop("checked", true);
                    $('#last_name_characters').prop('disabled', false);
                    $("#first_name_characters").val(7);
                    $("#last_name_characters").val(5);
                    placeNameBoxes();
                    $("input.first_name1").val("OGedCa");
                    $("input.first_name2").val("Il");
                    $("input.first_name3").val("a");
                    $("input.first_name4").val("u");
                    $("input.first_name5").val("d");
                    $("input.first_name7").val("Cba");
                    $("input.last_name1").val("TI");
                    $("input.last_name2").val("tIida");
                    $("input.last_name5").val("tl");
                    findNames();
                });
                $('#minimal').click(function () {
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", false);
                    $("#fixed").prop("checked", false);
                    $('#last_name_characters').prop('disabled', true);
                    $("#first_name_characters").val(7);
                    placeNameBoxes();
                    $("input.first_name1").val("OCGUQ");
                    $("input.first_name2").val("Ilidf");
                    findNames();
                });
                $('#tielt').click(function () {
                    $('#extra_names').val('Nielsen');
                    initNames();
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", false);
                    $("#fixed").prop("checked", false);
                    $('#last_name_characters').prop('disabled', true);
                    $("#first_name_characters").val(7);
                    placeNameBoxes();
                    $("input.first_name2").val("IELUHPJ");
                    $("input.first_name3").val("IELUHPJ");
                    $("input.first_name4").val("IELUHPJ");
                    findNames();
                });
                $('#jarle').click(function () {
                    $('#extra_names').val('Jarle,Zarna,Zarne');
                    initNames();
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", false);
                    $("#fixed").prop("checked", false);
                    $('#last_name_characters').prop('disabled', true);
                    $("#first_name_characters").val(5);
                    placeNameBoxes();
                    $("input.first_name2").val("AF");
                    $("input.first_name3").val("RP");
		    $("input.first_name4").val("NLAU");
		    $("input.first_name5").val("AEH");
                    findNames();
                });
                $('#fenella').click(function () {
                    $('#extra_names').val('Leenhouwer,Leenhouwfr');
                    initNames();
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", false);
                    $("#fixed").prop("checked", false);
                    $('#last_name_characters').prop('disabled', true);
                    $("#first_name_characters").val(10);
                    placeNameBoxes();
                    $("input.first_name2").val("FEHKNU");
                    $("input.first_name3").val("IELUHPJ");
                    $("input.first_name4").val("IELUHPJ");
                    $("input.first_name5").val("FEHKNU");
                    $("input.first_name6").val("OUL");
                    $("input.first_name7").val("OUL");
                    findNames();
                });        
                $('#schloss').click(function () {
                    $('#extra_names').val('Schlosseneck');
                    initNames();
                    resetNameBoxes();
                    $("#enable_last_name").prop("checked", false);
                    $("#fixed").prop("checked", false);
                    $('#last_name_characters').prop('disabled', true);
                    $("#first_name_characters").val(12);
                    placeNameBoxes();
                    $("input.first_name2").val("COG");
                    $("input.first_name3").val("IELUHPJ");
		    $("input.first_name4").val("IELUHPJ");
		    $("input.first_name5").val("COG");
		    $("input.first_name8").val("IELUHPJ");
		    $("input.first_name9").val("NM");
		    $("input.first_name10").val("IELUHPJ");
		    $("input.first_name11").val("COG");
		    $("input.first_name12").val("KJI");
                    findNames();
                });		    
                $('#enable_last_name').change(function () {
                    if (this.checked) $('#last_name_characters').prop('disabled', false);
                    else $('#last_name_characters').prop('disabled', true);
                    findNames();
                });
                placeNameBoxes();
                $("input[type='checkbox']").change(function () {
                    initNames();
                    doSearch();
				});
                $("input[type='text']").change(function () {
					doSearch();
                });
            });

        </script>
    </body>

</html>
